---
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostList from "@/components/PostList.astro";
import type { Frontmatter } from "@/types";

export async function getStaticPaths() {
  const allPosts = await Astro.glob<Frontmatter>("../post/*/*/*.md");
  const tags = [
    ...new Set(allPosts.map((post) => post.frontmatter.tags).flat()),
  ];
  return tags.map((tag) => ({
    params: { tag },
    props: {
      posts: allPosts.filter((post) => post.frontmatter.tags.includes(tag)),
    },
  }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout>
  <h2 class="text-xl italic mb-2">{`#${tag}`}</h2>
  <PostList posts={posts} />
</BaseLayout>
